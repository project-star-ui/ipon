<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ipón Challenge Tracker - Ultra Premium</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: 'Lato', sans-serif;
            background: linear-gradient(135deg, #1a1a1a, #2d1b69), url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="luxury" patternUnits="userSpaceOnUse" width="100" height="100"><circle cx="50" cy="50" r="2" fill="%23ffd700" opacity="0.1"/><circle cx="20" cy="20" r="1" fill="%23ba68c8" opacity="0.05"/><circle cx="80" cy="80" r="1" fill="%23ffd700" opacity="0.05"/></pattern></defs><rect width="100" height="100" fill="url(%23luxury)"/></svg>');
            background-size: cover;
            color: #e8eaf6;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
        }
        .header {
            text-align: center;
            margin: 30px 0;
            animation: slideDown 1.5s ease-out;
        }
        .header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 3.5em;
            color: #ffd700;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.8), 0 0 20px #ffd700;
            margin: 0;
            letter-spacing: 2px;
        }
        .header p {
            font-size: 1.3em;
            color: #ba68c8;
            margin: 15px 0;
            font-weight: 700;
        }
        .container {
            max-width: 800px;
            width: 95%;
            padding: 40px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05), rgba(0, 0, 0, 0.1));
            backdrop-filter: blur(20px);
            border-radius: 30px;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            margin: 20px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            animation: fadeInUp 1.5s ease-out;
        }
        @keyframes slideDown {
            from { transform: translateY(-100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .totals {
            display: flex;
            justify-content: space-around;
            margin-bottom: 40px;
            font-size: 1.4em;
            font-weight: 700;
        }
        .total-item {
            background: linear-gradient(135deg, #ffd700, #ff8f00);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2);
            color: #1a1a1a;
            text-align: center;
            transition: transform 0.4s, box-shadow 0.4s;
            position: relative;
            overflow: hidden;
        }
        .total-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        .total-item:hover::before {
            left: 100%;
        }
        .total-item:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }
        select, button {
            padding: 15px;
            border: 2px solid rgba(255, 215, 0, 0.5);
            border-radius: 20px;
            font-size: 1.1em;
            margin: 15px 0;
            width: 100%;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.4s;
            font-weight: 700;
        }
        /* Dropdown text color changed to black as requested */
        select {
            background: rgba(255, 255, 255, 0.1);
            color: #FFFFFF; /* changed from light to black */
            backdrop-filter: blur(10px);
        }
        /* Ensure option text is black in browsers that respect option styling */
        select option {
            color: #000;
        }
        select:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 0 0 15px #ffd700;
            color: #000;
        }
        button {
            background: linear-gradient(135deg, #ffd700, #ff8f00);
            color: #1a1a1a;
            cursor: pointer;
            font-weight: 700;
            position: relative;
        }
        button:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .person {
            display: flex;
            align-items: center;
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(135deg, rgba(186, 104, 200, 0.2), rgba(156, 39, 176, 0.2));
            border-radius: 20px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.4s;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        .person:hover {
            background: linear-gradient(135deg, rgba(186, 104, 200, 0.3), rgba(156, 39, 176, 0.3));
            transform: translateX(10px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }
        .person input {
            margin-right: 20px;
            transform: scale(1.3);
        }
        .person label {
            flex-grow: 1;
            font-weight: 700;
            color: #ffd700;
        }
        .scrollable {
            max-height: 350px;
            overflow-y: auto;
            margin-top: 30px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        .scrollable::-webkit-scrollbar {
            width: 10px;
        }
        .scrollable::-webkit-scrollbar-thumb {
            background: #ffd700;
            border-radius: 5px;
        }
        .footer {
            text-align: center;
            margin: 30px 0;
            color: #ba68c8;
            font-size: 1em;
            font-weight: 700;
        }
        .loading {
            display: none;
            text-align: center;
            margin: 15px 0;
            color: #ffd700;
            font-weight: 700;
        }
        .icon {
            margin-right: 10px;
        }
        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            overflow: hidden;
            margin-top: 10px;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffd700, #ff8f00);
            transition: width 0.5s;
        }

        /* High-contrast single-entry style for when a date is selected */
        .history-entry {
            background: linear-gradient(135deg, rgba(255,215,0,0.12), rgba(255,255,255,0.02));
            color: #fff;
            padding: 18px;
            margin-bottom: 12px;
            border-radius: 12px;
            border-left: 6px solid #ffd700;
            box-shadow: 0 8px 20px rgba(0,0,0,0.45);
            font-weight: 700;
        }
        .history-empty {
            background: rgba(255, 255, 255, 0.03);
            color: #e0e0ff;
            padding: 16px;
            border-radius: 10px;
            text-align: center;
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.02);
            font-weight: 700;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-crown icon"></i> Ipón Challenge Tracker</h1>
        <p>Goal: Save 100 PHP every Monday from Jan 5, 2026 to Jan 5, 2031</p>
    </div>
    <div class="container">
        <div class="totals">
            <div class="total-item">
                <i class="fas fa-user-tie icon"></i>Jonel Total: <span id="jonelTotal">0</span> PHP
                <div class="progress-bar"><div class="progress-fill" id="jonelProgress" style="width: 0%;"></div></div>
            </div>
            <div class="total-item">
                <i class="fas fa-user-tie icon"></i>Laarni Total: <span id="laarniTotal">0</span> PHP
                <div class="progress-bar"><div class="progress-fill" id="laarniProgress" style="width: 0%;"></div></div>
            </div>
            <div class="total-item">
                <i class="fas fa-coins icon"></i>Overall Total: <span id="overallTotal">0</span> PHP
                <div class="progress-bar"><div class="progress-fill" id="overallProgress" style="width: 0%;"></div></div>
            </div>
        </div>
        <select id="dateSelect">
            <option value="">Select a Monday</option>
        </select>
        <div id="tracker" style="display: none;">
            <div class="person">
                <input type="checkbox" id="jonelCheck">
                <label for="jonelCheck"><i class="fas fa-check-circle icon"></i>Jonel</label>
            </div>
            <div class="person">
                <input type="checkbox" id="laarniCheck">
                <label for="laarniCheck"><i class="fas fa-check-circle icon"></i>Laarni</label>
            </div>
            <button id="saveBtn">Save <i class="fas fa-save"></i></button>
            <div class="loading" id="loading"><i class="fas fa-spinner fa-spin"></i> Saving...</div>
        </div>
        <div class="scrollable" id="history" style="display: none;">
            <!-- History will show the selected date's entry (high-contrast) -->
        </div>
    </div>
    <div class="footer">
        <p>&copy; 2026 Ipón Challenge! ♥ </p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getDatabase, ref, set, get, onValue } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDgbAF-WYZCLEffxPEk1Ag8WFFaafpOiys",
            authDomain: "calq-lov2z.firebaseapp.com",
            databaseURL: "https://calq-lov2z-default-rtdb.firebaseio.com",
            projectId: "calq-lov2z",
            storageBucket: "calq-lov2z.firebasestorage.app",
            messagingSenderId: "194736866780",
            appId: "1:194736866780:web:65570e769737de54c2bb19"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const dateSelect = document.getElementById('dateSelect');
        const tracker = document.getElementById('tracker');
        const saveBtn = document.getElementById('saveBtn');
        const loading = document.getElementById('loading');
        const jonnelCheck = document.getElementById('jonelCheck');
        const laarniCheck = document.getElementById('laarniCheck');
        const jonnelTotal = document.getElementById('jonelTotal');
        const laarniTotal = document.getElementById('laarniTotal');
        const overallTotal = document.getElementById('overallTotal');
        const jonnelProgress = document.getElementById('jonelProgress');
        const laarniProgress = document.getElementById('laarniProgress');
        const overallProgress = document.getElementById('overallProgress');
        const history = document.getElementById('history');

        // Keep the deposits snapshot in memory so we can render only the selected date
        let allDeposits = {};

        // Generate Mondays from Jan 5, 2026 to Jan 5, 2031
        function generateMondays() {
            const start = new Date('Jan 5, 2026');
            const end = new Date('Jan 5, 2031');
            const mondays = [];
            let current = new Date(start);
            while (current <= end) {
                if (current.getDay() === 1) { // Monday
                    mondays.push(new Date(current));
                }
                current.setDate(current.getDate() + 1);
            }
            return mondays;
        }

        const mondays = generateMondays();
        mondays.forEach(date => {
            const option = document.createElement('option');
            option.value = date.toISOString().split('T')[0];
            option.textContent = date.toLocaleDateString();
            dateSelect.appendChild(option);
        });

        dateSelect.addEventListener('change', () => {
            if (dateSelect.value) {
                tracker.style.display = 'block';
                history.style.display = 'block'; // show history when a date is selected
                loadData(dateSelect.value);
                renderHistory(dateSelect.value);
                // smooth scroll to history so it becomes visible
                setTimeout(() => {
                    history.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 180);
            } else {
                tracker.style.display = 'none';
                history.style.display = 'none';
            }
        });

        function loadData(date) {
            const dateRef = ref(db, `deposits/${date}`);
            get(dateRef).then(snapshot => {
                const data = snapshot.val() || {};
                jonnelCheck.checked = data.jonel || false;
                laarniCheck.checked = data.laarni || false;
            }).catch(err => {
                console.error('Error loading date data:', err);
            });
        }

        saveBtn.addEventListener('click', () => {
            saveBtn.disabled = true;
            loading.style.display = 'block';
            const date = dateSelect.value;
            const data = {
                jonel: jonnelCheck.checked,
                laarni: laarniCheck.checked
            };
            set(ref(db, `deposits/${date}`), data).then(() => {
                saveBtn.disabled = false;
                loading.style.display = 'none';
                // re-render selected date in history to show update immediately
                renderHistory(date);
            }).catch(err => {
                console.error('Error saving data:', err);
                saveBtn.disabled = false;
                loading.style.display = 'none';
                alert('Error saving data. Please try again.');
            });
        });

        // Listen for totals and keep a local copy of all deposits
        const depositsRef = ref(db, 'deposits');
        onValue(depositsRef, snapshot => {
            const data = snapshot.val() || {};
            allDeposits = data; // update in-memory copy

            let jonelCount = 0, laarniCount = 0;
            Object.values(data).forEach(entry => {
                if (entry.jonel) jonelCount++;
                if (entry.laarni) laarniCount++;
            });
            const totalMondays = mondays.length;
            jonnelTotal.textContent = jonelCount * 100;
            laarniTotal.textContent = laarniCount * 100;
            overallTotal.textContent = (jonelCount + laarniCount) * 100;
            jonnelProgress.style.width = `${(jonelCount / totalMondays) * 100}%`;
            laarniProgress.style.width = `${(laarniCount / totalMondays) * 100}%`;
            overallProgress.style.width = `${((jonelCount + laarniCount) / (totalMondays * 2)) * 100}%`;

            // Render history according to currently selected date (if any)
            renderHistory(dateSelect.value);
        }, err => {
            console.error('Error listening for deposits:', err);
        });

        // Render only the selected date's entry (high-contrast and easy to read)
        function renderHistory(selectedDate) {
            history.innerHTML = '';
            if (!selectedDate) {
                // hide history if no date is selected
                history.style.display = 'none';
                return;
            }
            history.style.display = 'block';

            const entry = allDeposits && allDeposits[selectedDate];

            if (!entry) {
                const emptyDiv = document.createElement('div');
                emptyDiv.className = 'history-empty';
                emptyDiv.innerHTML = `<strong>${selectedDate}</strong><br>No record for this date. You can save a new entry using the tracker above.`;
                history.appendChild(emptyDiv);
                return;
            }

            // High-contrast single entry
            const div = document.createElement('div');
            div.className = 'history-entry';
            const jonelStatus = entry.jonel ? `<i class="fas fa-check" style="color: #ffd700;"></i> Yes` : `<i class="fas fa-times" style="color: #ba68c8;"></i> No`;
            const laarniStatus = entry.laarni ? `<i class="fas fa-check" style="color: #ffd700;"></i> Yes` : `<i class="fas fa-times" style="color: #ba68c8;"></i> No`;
            div.innerHTML = `<div style="font-size:1.05em;margin-bottom:8px;"><strong>${selectedDate}</strong></div>
                             <div style="display:flex;gap:16px;align-items:center;">
                                <div><i class="fas fa-user icon" style="color:#ffd700;"></i> Jonel: ${jonelStatus}</div>
                                <div><i class="fas fa-user icon" style="color:#ffd700;"></i> Laarni: ${laarniStatus}</div>
                             </div>`;
            history.appendChild(div);
        }
    </script>
</body>

</html>
